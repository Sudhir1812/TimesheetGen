<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add New Employee</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        #jsonPreview {
            background: #1e1e1e;
            color: #dcdcdc;
            padding: 15px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: Consolas, monospace;
            font-size: 14px;
        }
    </style>
</head>

<body class="bg-light">

<div class="container mt-5">
    <h2 class="mb-4">Add New Employee</h2>

    <form id="employeeForm" class="card p-4 shadow-sm">

        <div class="mb-3">
            <label class="form-label">Employee Name</label>
            <label for="employeeName"></label><input type="text" id="employeeName" class="form-control"
                                                     placeholder="Enter employee name" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Employee ID</label>
            <label for="employeeId"></label><input type="text" id="employeeId" class="form-control"
                                                   placeholder="Enter employee ID" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Email Address</label>
            <label for="email"></label><input type="email" id="email" class="form-control"
                                              placeholder="Enter employee email" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Provide Joining Date (dd-mm-yyyy)</label>
            <label for="joiningDate"></label>
            <input type="text" id="joiningDate"
                   class="form-control"
                   pattern="^\d{2}-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-\d{4}$"
                   placeholder="21-Feb-2022" required>
        </div>


        <h3>JSON Preview</h3>
        <pre id="jsonPreview"></pre>

        <button type="button" class="btn btn-success" onclick="saveEmployee()">Save Employee</button>


        <div style="height: 1em;"></div>

        <a href="/" class="btn btn-outline-secondary">Back to Home</a>

<!--        <a href="/" class="btn btn-secondary ms-3">Back to Home</a>-->



    </form>
</div>


<script>

    // Update JSON preview live
   function updatePreview() {
       const payload = {
           employeeName: document.getElementById("employeeName").value,
           employeeId: document.getElementById("employeeId").value,
           email: document.getElementById("email").value,
           joiningDate: document.getElementById("joiningDate").value
       };

       document.getElementById("jsonPreview").textContent =
           JSON.stringify(payload, null, 4);
   }

   // Attach live listeners
   document.querySelectorAll("#employeeForm input")
       .forEach(input => input.addEventListener("input", updatePreview));

   function saveEmployee() {

   const form = document.getElementById("employeeForm");
   if (!form.checkValidity()) { form.reportValidity();
   return; // prevent sending invalid data
   }

       // Create JSON payload exactly as required
       const payload = {

           employeeName: document.getElementById("employeeName").value,
           employeeId: document.getElementById("employeeId").value,
           email: document.getElementById("email").value,
           joiningDate: document.getElementById("joiningDate").value
       };

       fetch("/api/employees", {
           method: "POST",
           headers: { "Content-Type": "application/json" },
           body: JSON.stringify(payload)
       })
           .then(async response => {
               if (!response.ok) {
                   throw new Error(await response.text());
               }
               alert("Employee saved successfully!");

               // Clear form
               document.getElementById("employeeForm").reset();
           })
           .catch(err => alert("Error: " + err.message));
   }
    // Initial preview
    updatePreview();

</script>

</body>
</html>
